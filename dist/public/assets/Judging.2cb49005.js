var e=Object.defineProperty,i=Object.defineProperties,t=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(i,t,n)=>t in i?e(i,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[t]=n;import{d as a,o as d,c as g,l,A as u,a as c,t as m,g as h,e as b,m as p,F as v,r as j,b as y}from"./vendor.8d251a54.js";import{S as f,b as C,c as J,I as w}from"./index.ddf63b3b.js";var S=a({name:"JudgingScoring",computed:{originalJudging(){return this.$store.state.judging.originalJudging},criteria(){var e,i;return null==(i=null==(e=this.originalJudging)?void 0:e.judgingToCriteria)?void 0:i.criteria},submission(){var e,i;return null==(i=null==(e=this.originalJudging)?void 0:e.judging)?void 0:i.submission},newGeneralComment:{get(){var e;return null==(e=this.$store.state.judging.newJudging)?void 0:e.judging.comment},set(e){const i=this.cloneNewJudging();i.judging.comment=e,this.$store.commit("judging/"+f,i)}},newComment:{get(){var e;return null==(e=this.$store.state.judging.newJudging)?void 0:e.judgingToCriteria.comment},set(e){const i=this.cloneNewJudging();i.judgingToCriteria.comment=e,this.$store.commit("judging/"+f,i)}},newScore:{get(){var e;return null==(e=this.$store.state.judging.newJudging)?void 0:e.judgingToCriteria.score},set(e){const i=this.cloneNewJudging();i.judgingToCriteria.score=e,this.$store.commit("judging/"+f,i)}}},methods:{async save(){await this.$store.dispatch("judging/"+C)},cloneNewJudging(){return JSON.parse(JSON.stringify(this.$store.state.judging.newJudging))}}});const x={key:0},T=c("hr",null,null,-1),k={class:"card bg-dark"},B={class:"card-header"},D=b(" Editing "),$=b(" for "),O={class:"card-body"},I={class:"form-group"},N=c("label",{for:"score"},"Score",-1),P={class:"form-group"},U=c("label",{for:"comment"}," Comment ",-1),A={class:"card-footer"},E={key:1,class:"text-muted"};S.render=function(e,i,t,n,r,s){return e.originalJudging&&e.criteria&&e.submission?(d(),g("div",x,[l(c("textarea",{id:"comment","onUpdate:modelValue":i[1]||(i[1]=i=>e.newGeneralComment=i),maxlength:3e3,rows:5,class:"form-control",placeholder:"General comment"},null,512),[[u,e.newGeneralComment]]),T,c("div",k,[c("div",B,[D,c("b",null,m(e.criteria.name),1),$,c("b",null,m(e.submission.anonymisedAs),1)]),c("div",O,[c("div",I,[N,l(c("input",{id:"score","onUpdate:modelValue":i[2]||(i[2]=i=>e.newScore=i),type:"number",step:"1",min:"1",max:e.criteria.maxScore,class:"form-control"},null,8,["max"]),[[u,e.newScore]])]),c("div",P,[U,l(c("textarea",{id:"comment","onUpdate:modelValue":i[3]||(i[3]=i=>e.newComment=i),maxlength:3e3,rows:5,class:"form-control",placeholder:"Criteria specific"},null,512),[[u,e.newComment]])])]),c("div",A,[c("button",{type:"button",class:"btn btn-primary",onClick:i[4]||(i[4]=h((i=>e.save()),["prevent"]))}," Save changes ")])])])):(d(),g("div",E," Select a score to begin... "))};var G,R,F=a({name:"JudgingTable",data:()=>({sortBy:"name",sortByCriteria:1,sortDesc:!1}),computed:(G=((e,i)=>{for(var t in i||(i={}))r.call(i,t)&&o(e,t,i[t]);if(n)for(var t of n(i))s.call(i,t)&&o(e,t,i[t]);return e})({},p({round:e=>e.judging.currentRound,criterias:e=>e.judging.criterias,judgingDone:e=>e.judging.judgingDone,originalJudging:e=>e.judging.originalJudging,newJudging:e=>e.judging.newJudging})),R={sortedSubmissions(){const e=this.round.submissions||[];return"name"===this.sortBy?e.sort(((e,i)=>{var t,n;const r=null==(t=e.anonymisedAs)?void 0:t.toUpperCase(),s=null==(n=i.anonymisedAs)?void 0:n.toUpperCase();return r<s?this.sortDesc?-1:1:r>s?this.sortDesc?1:-1:0})):"total"===this.sortBy?e.sort(((e,i)=>{const t=this.getTotalScore(e.id),n=this.getTotalScore(i.id);return this.sortDesc?t-n:n-t})):"criteria"===this.sortBy?e.sort(((e,i)=>{const t=this.getScore(e.id,this.sortByCriteria),n=this.getScore(i.id,this.sortByCriteria);return this.sortDesc?t-n:n-t})):"completed"===this.sortBy&&e.sort(((e,i)=>{const t=this.isCompleted(e.id);return t===this.isCompleted(i.id)?0:this.sortDesc?t?1:-1:t?-1:1})),e},maxPossibleScore(){return this.criterias.reduce(((e,i)=>i.maxScore+e),0)}},i(G,t(R))),methods:{getScore(e,i){const t=this.$store.getters["judging/getJudgingToCriterias"]({submissionId:e,criteriaId:i});return t?t.score:0},getTotalScore(e){const i=this.judgingDone.find((i=>i.submissionId===e));return i?i.judgingToCriterias.reduce(((e,i)=>i.score+e),0):0},isCompleted(e){const i=this.judgingDone.find((i=>i.submissionId===e));return!!i&&i.judgingToCriterias.length===this.criterias.length},sortSubmissionsBy(e,i){this.sortBy=e,this.sortDesc=!this.sortDesc,"criteria"===e&&i&&(this.sortByCriteria=i)},selectForEditing(e,i){var t,n,r,s,o,a;(!this.originalJudging||!this.newJudging||(null==(t=this.originalJudging)?void 0:t.judgingToCriteria.comment)===(null==(n=this.newJudging)?void 0:n.judgingToCriteria.comment)&&(null==(r=this.originalJudging)?void 0:r.judgingToCriteria.score)===(null==(s=this.newJudging)?void 0:s.judgingToCriteria.score)&&(null==(o=this.originalJudging)?void 0:o.judging.comment)===(null==(a=this.newJudging)?void 0:a.judging.comment)||confirm("Changes may be lost, are you sure?"))&&this.$store.dispatch("judging/"+J,{submission:e,criteria:i})}}});const V={class:"card-body p-0"},q={class:"table table-bordered table-sm table-hover table-responsive-sm"},z={class:"text-left"},H={class:"text-left"},K=c("i",{class:"me-1 fas fa-edit"},null,-1);F.render=function(e,i,t,n,r,s){return d(),g("div",V,[c("table",q,[c("thead",null,[c("tr",null,[c("th",z,[c("a",{href:"#",onClick:i[1]||(i[1]=h((i=>e.sortSubmissionsBy("name")),["prevent"]))}," Entry's Name ")]),(d(!0),g(v,null,j(e.criterias,(i=>(d(),g("th",{key:i.id},[c("a",{href:"#",onClick:h((t=>e.sortSubmissionsBy("criteria",i.id)),["prevent"])},m(i.name),9,["onClick"])])))),128)),c("th",null,[c("a",{href:"#",onClick:i[2]||(i[2]=h((i=>e.sortSubmissionsBy("total")),["prevent"]))}," Total ")]),c("th",null,[c("a",{href:"#",onClick:i[3]||(i[3]=h((i=>e.sortSubmissionsBy("completed")),["prevent"]))}," Completed ")])])]),c("tbody",null,[(d(!0),g(v,null,j(e.sortedSubmissions,(i=>(d(),g("tr",{key:i.id},[c("td",H,m(i.anonymisedAs),1),(d(!0),g(v,null,j(e.criterias,(t=>(d(),g("td",{key:t.id},[c("a",{href:"#",class:"d-flex align-items-center justify-content-center",onClick:h((n=>e.selectForEditing(i,t)),["prevent"])},[K,b(" "+m(e.getScore(i.id,t.id)+`/ ${t.maxScore}`),1)],8,["onClick"])])))),128)),c("td",null,m(e.getTotalScore(i.id))+" / "+m(e.maxPossibleScore),1),c("td",null,[c("i",{class:["fa",e.isCompleted(i.id)?"fa-check text-success":"fa-times text-danger"]},null,2)])])))),128))])])])};var L=a({components:{JudgingTable:F,JudgingScoring:S},computed:p({user:e=>e.loggedInUser,currentRound:e=>e.judging.currentRound}),async created(){await this.$store.dispatch("judging/"+w)}});const M={class:"container-fluid"},Q={key:0,class:"row"},W={class:"col-md-8"},X={class:"col-md-4"},Y={key:1};L.render=function(e,i,t,n,r,s){const o=y("judging-table"),a=y("judging-scoring");return d(),g("div",M,[e.currentRound?(d(),g("div",Q,[c("div",W,[c(o)]),c("div",X,[c(a)])])):(d(),g("div",Y," Judging hasn't started or just ended or i fucked up, ops "))])};export default L;
