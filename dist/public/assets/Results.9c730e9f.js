var e=Object.defineProperty,s=Object.defineProperties,d=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(s,d,a)=>d in s?e(s,d,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[d]=a;import{a as i,J as n}from"./index.a02505d2.js";import{d as o,o as c,c as u,a as m,t as g,F as p,r as v,e as y,f as h,m as b,M as f,y as j,z as C,b as S,A as k,B as w,C as x,g as M}from"./vendor.28fcb284.js";import{_ as F}from"./DataTable.2986ebb1.js";var D=o({name:"CountryFlag",props:{country:{type:Object,required:!0},title:{type:String,default:null}}});const O={class:"d-flex align-items-center"},T={class:"ms-2"},J={key:0},$={key:1};D.render=function(e,s,d,a,t,l){return c(),u("div",O,[m("div",{class:"country-flag",style:`background-image: url(https://osu.ppy.sh/images/flags/${e.country.code}.png)`},null,4),m("div",T,[e.title?(c(),u("span",J,g(e.title),1)):(c(),u("span",$,g(e.country.name),1))])])};var A=o({name:"JudgingDetail",props:{submission:{type:Object,default:()=>null}},data:()=>({commentsExpanded:[]}),methods:{showComment(e){const s=this.commentsExpanded.findIndex((s=>s===e));-1!==s?this.commentsExpanded.splice(s,1):this.commentsExpanded.push(e)},getCollapseClass(e){return this.commentsExpanded.includes(e)?"fa-chevron-down":"fa-chevron-right"}}});const E={id:"detailModal",class:"modal fade",tabindex:"-1"},I={class:"modal-dialog modal-lg"},P={key:0,class:"modal-content"},R={class:"modal-header"},L={class:"modal-title"},z=m("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal"}," Ã— ",-1),N={class:"modal-body"},_=y(": "),q={style:{"white-space":"pre-line"}},B={key:0};A.render=function(e,s,d,a,t,l){return c(),u("div",E,[m("div",I,[e.submission?(c(),u("div",P,[m("div",R,[m("h5",L,g(e.submission.team.name)+" - "+g(e.submission.team.country.name),1),z]),m("div",N,[(c(!0),u(p,null,v(e.submission.judging,((s,d)=>(c(),u("div",{key:s.id},[m("b",null,g(s.judge.username),1),(c(!0),u(p,null,v(s.judgingToCriterias,(s=>(c(),u("div",{key:s.id,class:"my-1"},[m("a",{"data-bs-toggle":"collapse",href:`#judgingToCriteria${s.id}`,onClick:d=>e.showComment(s.id)},[m("small",null,[m("i",{class:["fas me-2",e.getCollapseClass(s.id)]},null,2)]),y(" "+g(s.criteria.name)+" ",1),m("b",null,"("+g(s.score)+")",1),_],8,["href","onClick"]),m("p",{id:`judgingToCriteria${s.id}`,class:"text-light ms-3 collapse"},[m("span",q,g(s.comment),1)],8,["id"])])))),128)),d<e.submission.judging.length-1?(c(),u("hr",B)):h("",!0)])))),128))])])):h("",!0)])])};var G,U,V=o({name:"Leaderboard",components:{CountryFlag:D,JudgingDetail:A,DataTable:F},props:{judgingType:{type:Number,required:!0},displayMode:{type:String,required:!0}},data:()=>({selectedScore:null,sortDesc:!1,round:null,criterias:[],teamsScores:[],judgesCorrel:[]}),computed:(G=((e,s)=>{for(var d in s||(s={}))t.call(s,d)&&r(e,d,s[d]);if(a)for(var d of a(s))l.call(s,d)&&r(e,d,s[d]);return e})({},b({rounds:e=>e.rounds})),U={standardContest(){return this.$store.getters.standardContest},scoreDetail(){var e,s;if(this.selectedScore)return null==(s=null==(e=this.round)?void 0:e.submissions)?void 0:s.find((e=>{var s;return e.team.id==(null==(s=this.selectedScore)?void 0:s.team.id)}))},judges(){var e;return(null==(e=this.round)?void 0:e.judgeToRounds.map((e=>e.user)))||[]},fields(){const e=[{key:"index",label:"#"},{key:"team",label:"Team"}];return"criterias"===this.displayMode?e.push(...this.criterias.map((e=>({key:"criteria-"+e.id,label:e.name})))):e.push(...this.judges.map((e=>({key:"judge-"+e.id,label:e.username})))),e.push({key:"rawFinalScore",label:"Final Score (raw)"},{key:"standardizedFinalScore",label:"Final Score (standardized)",formatter:this.getFinalScore}),e},items(){return this.teamsScores.map((e=>{const s={team:e.team,rawFinalScore:e.rawFinalScore,standardizedFinalScore:e.standardizedFinalScore,clickable:!0};if("criterias"===this.displayMode)for(const d of this.criterias)s["criteria-"+d.id]=this.getCriteriaScore(e,d.id);else for(const d of this.judges)s["judge-"+d.id]=this.getJudgeScore(e,d.id,"detail"===this.displayMode);return s}))}},s(G,d(U))),watch:{judgingType:{async handler(e){var s;this.rounds.length||await this.$store.dispatch(i,this.standardContest.id);const d=this.$route.params.id||(null==(s=this.rounds[0])?void 0:s.id),{data:a}=await this.$http.get(`/api/rounds/${d}/results?type=${e}`);this.round=a.round,this.criterias=a.criterias,this.teamsScores=a.teamsScores,this.judgesCorrel=a.judgesCorrel},immediate:!0}},methods:{openDetailModal(e){this.selectedScore=e;const s=document.getElementById("detailModal");let d=f.getInstance(s);d||(d=new f(s)),d.toggle()},getCriteriaScore(e,s){var d;return(null==(d=e.criteriaSum.find((e=>e.criteriaId===s)))?void 0:d.sum)||0},getJudgeScore(e,s,d=!1){const a=e.judgingSum.find((e=>e.judgeId===s)),t=(null==a?void 0:a.standardized)||0;return d?`${(null==a?void 0:a.sum)||0} (${t.toFixed(3)})`:(null==a?void 0:a.sum)||0},getJudgeAvg(e){var s;return(null==(s=this.judgesCorrel.find((s=>s.id===e)))?void 0:s.rawAvg.toFixed(4))||0},getJudgeSd(e){var s;return(null==(s=this.judgesCorrel.find((s=>s.id===e)))?void 0:s.sd.toFixed(4))||0},getJudgeCorrel(e){var s;return((null==(s=this.judgesCorrel.find((s=>s.id===e)))?void 0:s.correl)||0).toFixed(4)},getFinalScore:e=>!e||isNaN(e)?"0":e.toFixed(4)}});const Y=x();j("data-v-5a2053da");const H={class:"cursor-default"},K=m("td",null,null,-1),Q=m("td",null,"AVG",-1),W=m("td",null,null,-1),X=m("td",null,null,-1),Z={class:"cursor-default"},ee=m("td",null,null,-1),se=m("td",null,"SD",-1),de=m("td",null,null,-1),ae=m("td",null,null,-1),te={class:"cursor-default"},le=m("td",null,null,-1),re=m("td",null,"COR",-1),ie=m("td",null,null,-1),ne=m("td",null,null,-1);C();const oe=Y(((e,s,d,a,t,l)=>{const r=S("country-flag"),i=S("data-table"),n=S("judging-detail");return c(),u(p,null,[m(i,w(e.$attrs,{fields:e.fields,items:e.items,class:"leaderboard",onRowClick:e.openDetailModal}),k({"cell-index":Y((({index:e})=>[y(g(e+1),1)])),"cell-team":Y((({item:e})=>[m(r,{country:e.team.country,title:e.team.name},null,8,["country","title"])])),_:2},["detail"===e.displayMode?{name:"custom-rows",fn:Y((()=>[m("tr",H,[K,Q,(c(!0),u(p,null,v(e.judges,(s=>(c(),u("td",{key:s.id},g(e.getJudgeAvg(s.id)),1)))),128)),W,X]),m("tr",Z,[ee,se,(c(!0),u(p,null,v(e.judges,(s=>(c(),u("td",{key:s.id},g(e.getJudgeSd(s.id)),1)))),128)),de,ae]),m("tr",te,[le,re,(c(!0),u(p,null,v(e.judges,(s=>(c(),u("td",{key:s.id},g(e.getJudgeCorrel(s.id)),1)))),128)),ie,ne])]))}:void 0]),1040,["fields","items","onRowClick"]),m(n,{submission:e.scoreDetail},null,8,["submission"])],64)}));V.render=oe,V.__scopeId="data-v-5a2053da";var ce=o({name:"Results",components:{Leaderboard:V},data:()=>({judgingType:n.Mappers,displayMode:"criterias"})});const ue={class:"container-fluid"},me={class:"row mb-5"},ge={class:"col"},pe={class:"card card-section"},ve=m("div",{class:"card-header"},[m("div",{class:"card-header-back"}," Leaderboard "),m("div",{class:"card-header-sub"},[m("div",{class:"card-header-title"}," LEADERBOARD ")])],-1),ye={class:"card-body"},he={class:"row"},be={class:"col-lg-3"},fe={class:"row"},je={class:"col-sm"},Ce={class:"card"},Se=m("div",{class:"card-header"}," JUDGING ",-1),ke={class:"card-body"},we={class:"row"},xe={class:"col-sm"},Me={class:"card"},Fe=m("div",{class:"card-header"}," ROUND ",-1),De={class:"card-body"},Oe=m("div",null,"ALL",-1),Te={class:"row"},Je={class:"col-sm"},$e={class:"card"},Ae=m("div",{class:"card-header"}," DISPLAY ",-1),Ee={class:"card-body"},Ie=y(" | "),Pe=y(" | "),Re={class:"col-lg-9"};ce.render=function(e,s,d,a,t,l){const r=S("leaderboard");return c(),u("div",ue,[m("div",me,[m("div",ge,[m("div",pe,[ve,m("div",ye,[m("div",he,[m("div",be,[m("div",fe,[m("div",je,[m("div",Ce,[Se,m("div",ke,[m("a",{class:"me-2",href:"#",onClick:s[1]||(s[1]=M((s=>e.judgingType=1),["prevent"]))}," mapper "),m("a",{href:"#",onClick:s[2]||(s[2]=M((s=>e.judgingType=2),["prevent"]))}," player ")])])])]),m("div",we,[m("div",xe,[m("div",Me,[Fe,m("div",De,[(c(),u(p,null,v(4,(e=>m("div",{key:e},g(e),1))),64)),Oe])])])]),m("div",Te,[m("div",Je,[m("div",$e,[Ae,m("div",Ee,[m("a",{href:"#",class:"criterias"===e.displayMode?"border-bottom border-secondary":"",onClick:s[3]||(s[3]=M((s=>e.displayMode="criterias"),["prevent"]))}," Per criteria ",2),Ie,m("a",{href:"#",class:"judges"===e.displayMode?"border-bottom border-secondary":"",onClick:s[4]||(s[4]=M((s=>e.displayMode="judges"),["prevent"]))}," Per judge ",2),Pe,m("a",{href:"#",class:"detail"===e.displayMode?"border-bottom border-secondary":"",onClick:s[5]||(s[5]=M((s=>e.displayMode="detail"),["prevent"]))}," Std detail ",2)])])])])]),m("div",Re,[m(r,{class:"h-100","display-mode":e.displayMode,"judging-type":e.judgingType},null,8,["display-mode","judging-type"])])])])])])])])};export default ce;
