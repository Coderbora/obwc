import{C as e}from"./index.cf13eba2.js";import{_ as t}from"./DataTable.ab8426c4.js";import{d as a,o as s,c as n,a as i,l as m,A as o,F as r,r as l,t as d,f as c,E as u,b as p,w as b}from"./vendor.6e598276.js";var f=a({name:"StaffTeamUpdate",props:{teamProp:{type:Object,default:()=>null}},emits:["update:team","remove:team"],data:()=>({name:"",users:[]}),watch:{teamProp(e){this.name=(null==e?void 0:e.name)||"",this.users=(null==e?void 0:e.users)||[]}},methods:{async update(){const{data:e}=await this.$http.put(`/api/staff/teams/${this.teamProp.id}`,{name:this.name});this.$emit("update:team",e),this.name=e.name},async removeUser(e){if(!confirm("Remove user from the team?"))return;const{data:t}=await this.$http.put(`/api/staff/teams/${this.teamProp.id}/removeUser`,{userId:e});this.$emit("update:team",t),this.users=t.users},async removeTeam(){confirm("This will delete all team related data (name, users, invitations), are you sure?")&&(await this.$http.delete(`/api/staff/teams/${this.teamProp.id}`),this.$emit("remove:team",this.teamProp.id))}}});const h={class:"modal fade",tabindex:"-1"},v={class:"modal-dialog modal-xl"},y={class:"modal-content"},k=i("div",{class:"modal-header"},[i("h5",{class:"modal-title"}," Update team "),i("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),g={key:0,class:"modal-body"},$={class:"container"},C={class:"row mb-2"},w={class:"col-sm"},T=i("hr",null,null,-1),U={class:"row"},x=i("hr",null,null,-1),L={class:"row"},I={class:"col-sm"},P={class:"modal-footer"},j=i("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Close ",-1);f.render=function(e,t,a,u,p,b){return s(),n("div",h,[i("div",v,[i("div",y,[k,e.teamProp?(s(),n("div",g,[i("div",$,[i("div",C,[i("div",w,[m(i("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.name=t),type:"text",class:"form-control",placeholder:"Name..."},null,512),[[o,e.name]]),i("button",{class:"btn btn-sm btn-primary mt-2",onClick:t[2]||(t[2]=(...t)=>e.update&&e.update(...t))}," Update name ")])]),T,i("div",U,[(s(!0),n(r,null,l(e.users,(t=>(s(),n("button",{key:t.id,class:"btn btn-sm btn-danger mr-2 mb-2",onClick:a=>e.removeUser(t.id)}," Remove "+d(t.username),9,["onClick"])))),128))]),x,i("div",L,[i("div",I,[i("button",{class:"btn btn-sm btn-danger",onClick:t[3]||(t[3]=(...t)=>e.removeTeam&&e.removeTeam(...t))}," Delete everything ")])])])])):c("",!0),i("div",P,[j,i("button",{type:"button",class:"btn btn-primary",onClick:t[4]||(t[4]=(...t)=>e.update&&e.update(...t))}," Save changes ")])])])])};var D=a({props:{users:{type:Array,required:!0}},setup:e=>()=>e.users.map(((t,a)=>u("span",[u("a",{href:`https://osu.ppy.sh/users/${t.osuId}`,target:"_blank"},t.username),a<e.users.length-1?", ":void 0])))}),S=a({components:{DataTable:t,StaffTeamUpdate:f,UsersLinks:D},data:()=>({teams:[],selectedTeam:null,fields:[{key:"country",label:"Country",formatter:e=>e.name},{key:"name",label:"Name"},{key:"captain",label:"Captain",formatter:e=>e.username},{key:"users",label:"Accepted Users"},{key:"invitations",label:"Invited Users"}],generatedTeamList:""}),async created(){const{data:t}=await this.$http.get(`/api/staff/contests/${this.$route.params.id||e.Standard}/teams`);this.teams=t},methods:{async confirm(e){await this.$http.put(`/api/staff/teams/${e}/confirm`);const t=this.teams.findIndex((t=>t.id===e));-1!==t&&(this.teams[t].wasConfirmed=!0)},async deny(e){await this.$http.put(`/api/staff/teams/${e}/deny`);const t=this.teams.findIndex((t=>t.id===e));-1!==t&&(this.teams[t].wasConfirmed=!1)},update(e){const t=this.teams.findIndex((t=>t.id===e.id));-1!==t&&(this.teams[t]=e)},remove(e){const t=this.teams.findIndex((t=>t.id===e));-1!==t&&this.teams.splice(t,1)},generateTeamList(e){if(this.generatedTeamList&&!confirm("this will reset the view"))return;let t=e?this.teams.filter((e=>e.wasConfirmed)):this.teams;this.generatedTeamList="|  | Country | Name | Members |\n| :-: | :-: | :-: | :-- |\n",this.generatedTeamList+=t.map((e=>`| ![][flag_${e.country.code}] | **${e.country.name}** | **${e.name}** | **[${e.captain.username}](https://osu.ppy.sh/users/${e.captain.osuId})**, ${e.users.map((e=>`[${e.username}](https://osu.ppy.sh/users/${e.osuId})`)).join(", ")} |\n`))}}});const _={class:"container"},A={class:"row mb-2"},N={class:"col-sm"},R={class:"row"},E={class:"col-sm"};S.render=function(e,t,a,r,l,d){const u=p("users-links"),f=p("data-table"),h=p("staff-team-update");return s(),n("div",_,[i("div",A,[i("div",N,[i("button",{class:"btn btn-sm btn-info me-2",onClick:t[1]||(t[1]=t=>e.generateTeamList(!1))}," generate list "),i("button",{class:"btn btn-sm btn-info",onClick:t[2]||(t[2]=t=>e.generateTeamList(!0))}," generate list (only confirmed) "),e.generatedTeamList?m((s(),n("textarea",{key:0,"onUpdate:modelValue":t[3]||(t[3]=t=>e.generatedTeamList=t),class:"my-4 bg-white text-dark form-control form-control-sm fs-xs",rows:"10"},null,512)),[[o,e.generatedTeamList,void 0,{trim:!0}]]):c("",!0)])]),i("div",R,[i("div",E,[i(f,{items:e.teams,fields:e.fields},{"cell-users":b((({value:e})=>[i(u,{users:e},null,8,["users"])])),"cell-invitations":b((({value:e})=>[i(u,{users:e},null,8,["users"])])),actions:b((({item:t})=>[i("button",{class:"btn btn-sm btn-primary me-2","data-bs-toggle":"modal","data-bs-target":"#teamUpdate",onClick:a=>e.selectedTeam=t}," Edit ",8,["onClick"]),t.wasConfirmed?(s(),n("button",{key:1,class:"btn btn-sm btn-danger",onClick:a=>e.deny(t.id)}," Deny ",8,["onClick"])):(s(),n("button",{key:0,class:"btn btn-sm btn-success",onClick:a=>e.confirm(t.id)}," Confirm ",8,["onClick"]))])),_:1},8,["items","fields"])])]),i(h,{id:"teamUpdate","team-prop":e.selectedTeam,"onUpdate:team":t[4]||(t[4]=t=>e.update(t)),"onRemove:team":t[5]||(t[5]=t=>e.remove(t))},null,8,["team-prop"])])};export default S;
